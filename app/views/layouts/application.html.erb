<!DOCTYPE html>
<html>
  <head>
    <title>ブックマート - 大学内中古参考書取引サイト</title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <script src="https://kit.fontawesome.com/7654f8b8fe.js" crossorigin="anonymous"></script>
    <%= stylesheet_pack_tag 'application', media: 'all', 'data-turbolinks-track': 'reload' %>
    <link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick.css"/>
    <%= stylesheet_link_tag 'application', media: 'all', 'data-turbolinks-track': 'reload' %>

    <%= javascript_pack_tag 'application', 'data-turbolinks-track': 'reload' %>
    <script type="text/javascript" src="//cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick.min.js"></script>
  </head>

  <body class="d-flex flex-column min-vh-100">
    <header class="border border-dark">
      <nav class="navbar navbar-expand-lg navbar-light px-4">
        <%= link_to root_path, class:"btn btn-lg btn-outline-secondary px-5" do %>
          <i class="fas fa-home"></i> LOGO
        <% end %>

        <button class="navbar-toggler except-small-screen" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse except-small-screen" id="navbarSupportedContent">
          <ul class="navbar-nav mt-3 ml-auto">
            <% if admin_signed_in? %>
              <%= render 'layouts/admin_nav_links' %>
            <% elsif customer_signed_in? %>
              <%= render 'layouts/customer_nav_links' %>
            <% else %>
              <%= render 'layouts/guest_nav_links' %>
            <% end %>
          </ul>
        </div>
      </nav>
      <div class="row">
        <div class="col">
          <div class="px-4">
            <p>
              <button class="btn btn-sm btn-outline-secondary" type="button" data-toggle="collapse" data-target="#multiCollapseExample1" aria-expanded="false" aria-controls="multiCollapseExample1">
                <i class="fa-solid fa-magnifying-glass"></i>
              </button>
            </p>
            <div class="row">
              <div class="col">
                <div class="collapse multi-collapse" id="multiCollapseExample1">
                  <div class="">
                    <%= search_form_for @q, url: search_items_path do |f| %>
                      <%= f.label :name_cont, '書籍検索' %>
                      <%= f.search_field :name_cont %>
                      <%= f.submit '検索' %>
                      <div>
                      投稿日
                      <%= f.radio_button :created_at_gteq, Date.today.at_beginning_of_week, id: 'created_at_this_week', checked: true %> 今週
                      <%= f.radio_button :created_at_gteq, Date.today.at_beginning_of_month, id: 'created_at_this_month' %> 今月
                      <%= f.radio_button :created_at_gteq, Date.today.at_beginning_of_year, id: 'created_at_this_year' %> 今年
                      </div>
                    <% end %>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <!-- ゲスト機能と未ログインとの差がないので凍結-->
                <!--<%# unless customer_signed_in? || admin_signed_in? %>-->
                <!--  <div class="col-md-3">-->
                <!--    <div>-->
                <!--      <%#= link_to 'ゲストログイン(閲覧用)', guest_sign_in_path, method: :post %>-->
                <!--    </div>-->
                <!--  </div>-->
                <!--<%# end %>-->
        <!--ここまで-->
        <% if customer_signed_in? %>
          <div class="col-md-3">
            <div>
              <%= current_customer.no_nick_name %>さん、おかえり！
            </div>
          </div>
        <% elsif admin_signed_in? %>
          <div class="col-md-3">
            <div>
              運営者さん、おかえり！
            </div>
          </div>
        <% end %>
      </div>

      <div id="sp-menu" class="border border-dark p-3 text-secondary">
        <h2 class="text-center mt-5">MENU</h2>
        <ul class="list-unstyled">
          <li>
            <%= link_to homes_about_path, 'data-turbolinks': false, class:"text-dark" do %>
              <i class="fas fa-link"></i> About
            <% end %>
          </li>
          <li>
            <%= link_to items_path, class:"text-dark" do %>
              <i class="fas fa-book"></i> 商品リスト
            <% end %>
          </li>
          <li>
            <%= link_to items_tag_path, class:"text-dark" do %>
              <i class="fas fa-tags"></i> タグ検索
            <% end %>
          </li>
          <% if admin_signed_in? %>
            <li>
              <%= link_to admin_customers_path, class:"text-dark" do %>
                <i class="fas fa-users"></i> 会員リスト
              <% end %>
            </li>
            <li>
              <%= link_to admin_orders_path, class:"text-dark" do %>
                <i class="far fa-address-book"></i> 取引履歴リスト
              <% end %>
            </li>
          <% else %>
            <li>
              <%= link_to favorites_path, class:"text-dark" do %>
                <i class="fa-solid fa-heart"></i> お気に入り
              <% end %>
            </li>
            <li>
              <%= link_to mypage_path, class:"text-dark" do %>
                <i class="fas fa-user"></i> マイページ
              <% end %>
            </li>
            <li>
              <%= link_to notices_path, class:"text-dark" do %>
                <i class="fas fa-envelope"></i> 通知
                <% if customer_signed_in? && @unchecked_notices.any? %>
                  <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger text-white">
                    <%= @unchecked_notices.count %>
                  </span>
                <% elsif admin_signed_in? && @unchecked_admin_notices.any? %>
                  <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger text-white">
                    <%= @unchecked_admin_notices.count %>
                  </span>
                <% end %>
              <% end %>
            </li>
          <% end %>
          <% unless customer_signed_in? || admin_signed_in? %>
            <li>
              <%= link_to new_customer_registration_path, class:"text-dark" do %>
                <i class="fas fa-user-plus"></i> 新規登録
              <% end %>
            </li>
            <li>
              <%= link_to new_customer_session_path, class:"text-dark" do %>
                <i class="fas fa-sign-in-alt"></i> ログイン
              <% end %>
            </li>
          <% end %>
          <% if customer_signed_in? || admin_signed_in? %>
            <li>
              <%= link_to destroy_customer_session_path, method: :delete, class:"text-dark" do %>
                <i class="fas fa-sign-out-alt"></i> ログアウト
              <% end %>
            </li>
          <% end %>
          <li>
            <%= link_to new_item_path, class: "text-danger" do %>
              <i class="fa-solid fa-camera"></i> 出品する
            <% end %>
          </li>
        </ul>
      </div>

      <div id="hm-icon">
        <a class="menu-trigger" href="#">
          <span></span>
          <span></span>
          <span></span>
        </a>
      </div>

    </header>

    <main class="container-fluid flex-grow-1 border border-dark background-wrapper">
      <div class="mt-5 xside">
        <% if flash[:alert] %>
          <p class="alert alert-danger"><%= alert %>新規登録のリンクは<%= link_to "こちら", new_customer_registration_path %></p>
        <% end %>
        <%= yield %>
      </div>
    </main>


    <footer class="container-fluid border border-dark p-4">
      <div class="text-center">
        <p>© 2024 jag-800</p>
      </div>
    </footer>
  </body>
</html>

